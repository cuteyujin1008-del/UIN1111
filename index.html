<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Kakao Share</title>
  <script src="https://developers.kakao.com/sdk/js/kakao.js"></script>
  <script>
    Kakao.init("ff9ae14e50059eda1305ea6dc9c4e3cf");

    function isDetailMode() {
      return new URLSearchParams(location.search).get("detail") === "1";
    }

    function sendKakao() {
      const qs = new URLSearchParams(location.search);
      const msg = qs.get("msg") || "";

      // ğŸ”‘ í˜„ì¬ ë§í¬ë¥¼ ë³µì‚¬í•´ì„œ detail=1ë§Œ ì¶”ê°€
      const url = new URL(location.href);
      url.searchParams.set("detail", "1");

      Kakao.Share.sendDefault({
        objectType: "text",
        text: msg,
        link: {
          mobileWebUrl: url.toString(),
          webUrl: url.toString()
        }
      });
    }

    function handleLoad() {
      if (isDetailMode()) {
        // âœ… ìì„¸íˆ ë³´ê¸° â†’ PDF ìƒì„± í•¨ìˆ˜ë¡œ ì´ë™
        // (msg ê·¸ëŒ€ë¡œ ì „ë‹¬)
        const qs = new URLSearchParams(location.search);
        const msg = qs.get("msg") || "";

        const pdfUrl =
          "/.netlify/functions/voucher?msg=" +
          encodeURIComponent(msg);

        location.replace(pdfUrl);
      } else {
        // âœ… ìµœì´ˆ ì—´ë¦¼ â†’ ì¹´ì¹´ì˜¤ ê³µìœ 
        sendKakao();
      }
    }
  </script>
</head>
<body onload="handleLoad()"></body>
</html>
