<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Kakao Share</title>
  <script src="https://developers.kakao.com/sdk/js/kakao.js"></script>
  <script>
    Kakao.init("ff9ae14e50059eda1305ea6dc9c4e3cf");

    function isDetailMode() {
      const qs = new URLSearchParams(window.location.search);
      return qs.get("detail") === "1";
    }

    function sendMsg() {
      const qs = new URLSearchParams(window.location.search);
      const msg = qs.get("msg") || "메시지가 전달되지 않았습니다.";

      const url = new URL(window.location.href);
      url.search = "";
      url.searchParams.set("detail", "1");
      const detailUrl = url.toString();

      Kakao.Share.sendDefault({
        objectType: "text",
        text: msg,
        link: {
          mobileWebUrl: detailUrl,
          webUrl: detailUrl
        }
      });
    }

    function handleLoad() {
      if (isDetailMode()) {
        // 즉시 닫기 시도 + 즉시 빈 페이지 이동
        window.close();
        location.replace("about:blank");
      } else {
        sendMsg();
      }
    }
  </script>
</head>
<body onload="handleLoad()">
</body>
</html>
