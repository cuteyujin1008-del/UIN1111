<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ì „í‘œ ì•Œë¦¼</title>
  <script src="https://developers.kakao.com/sdk/js/kakao.js"></script>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    pre { white-space: pre-wrap; word-break: break-word; font-size: 15px; }
    .btn {
      display: inline-block; margin-top: 12px; padding: 10px 14px;
      border: 1px solid #ddd; border-radius: 8px; text-decoration: none;
    }
  </style>
</head>

<body>
  <!-- âœ… detail=1 ì¼ ë•Œë§Œ ë³´ì—¬ì¤„ í™”ë©´ -->
  <div id="detailView" style="display:none;">
    <h2>ğŸ“„ ì „í‘œ ë‚´ìš©</h2>
    <pre id="msg">ë©”ì‹œì§€ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</pre>

    <!-- PDF ë²„íŠ¼(ìˆì„ ë•Œë§Œ ë³´ì—¬ì¤Œ) -->
    <a id="pdfBtn" class="btn" href="#" target="_blank" style="display:none;">ğŸ“ PDF ì—´ê¸°</a>
  </div>

  <script>
  const params = new URLSearchParams(window.location.search);
  const detail = params.get("detail");
  const msg = params.get("msg");

  // ğŸ”¥ ìì„¸íˆ ë³´ê¸° ëˆŒë €ì„ ë•Œ
  if (detail === "1") {
    // PDFë¡œ ì¦‰ì‹œ ì´ë™
    location.replace("/voucher_template.pdf");
  }
</script>
  <!-- âœ… ì²˜ìŒ ì—´ë¦´ ë•Œ(ì¹´í†¡ ê³µìœ  ì‹œë„) fallback ì•ˆë‚´ -->
  <div id="shareFallback" style="display:none;">
    <h2>ğŸ“© ì¹´ì¹´ì˜¤í†¡ ê³µìœ  ì¤‘...</h2>
    <p>ì ì‹œ í›„ ê³µìœ ì°½ì´ ëœ¨ì§€ ì•Šìœ¼ë©´, ë¸Œë¼ìš°ì €ì—ì„œ íŒì—… ì°¨ë‹¨ì„ í•´ì œí•˜ê±°ë‚˜ ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.</p>
  </div>

  <script>
    // âœ… ë„ˆ ì¹´ì¹´ì˜¤ JS í‚¤
    Kakao.init("ff9ae14e50059eda1305ea6dc9c4e3cf");

    const params = new URLSearchParams(window.location.search);
    const isDetail = params.get("detail") === "1";

    function buildDetailUrl() {
      // í˜„ì¬ í˜ì´ì§€ë¥¼ ê¸°ì¤€ìœ¼ë¡œ detail=1 ë§í¬ ìƒì„±
      const url = new URL(window.location.origin + window.location.pathname);
      url.searchParams.set("detail", "1");

      // ğŸ”¥ msg, pdf ê·¸ëŒ€ë¡œ ì „ë‹¬ (ìì„¸íˆë³´ê¸° í™”ë©´ì—ì„œ ì‚¬ìš©)
      const msg = params.get("msg");
      const pdf = params.get("pdf");
      if (msg) url.searchParams.set("msg", msg);
      if (pdf) url.searchParams.set("pdf", pdf);

      return url.toString();
    }

    function sendKakaoShare() {
      const msg = params.get("msg") || "ë©”ì‹œì§€ê°€ ì „ë‹¬ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.";
      const detailUrl = buildDetailUrl();

      document.getElementById("shareFallback").style.display = "block";

      Kakao.Share.sendDefault({
        objectType: "text",
        text: msg,
        link: {
          mobileWebUrl: detailUrl,
          webUrl: detailUrl
        }
      });
    }

    function showDetailPage() {
      document.getElementById("detailView").style.display = "block";

      const msg = params.get("msg");
      document.getElementById("msg").textContent = msg ? msg : "ë©”ì‹œì§€ê°€ ì—†ìŠµë‹ˆë‹¤.";

      // âœ… detail ëª¨ë“œì—ì„œë§Œ PDF ë²„íŠ¼ ë…¸ì¶œ
      const pdf = params.get("pdf");
      if (pdf) {
        const btn = document.getElementById("pdfBtn");
        btn.href = pdf;
        btn.style.display = "inline-block";
      }
    }

    window.onload = function () {
      if (isDetail) {
        // âœ… ì¹´í†¡ì—ì„œ "ìì„¸íˆ ë³´ê¸°" ëˆŒë €ì„ ë•Œ = ì „í‘œ ë‚´ìš© í™”ë©´
        showDetailPage();
      } else {
        // âœ… Glideì—ì„œ ë§í¬ ì—´ë ¸ì„ ë•Œ = ì¹´í†¡ ê³µìœ  ë¨¼ì €
        sendKakaoShare();
      }
    };
  </script>
</body>
</html>
